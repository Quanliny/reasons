<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›…æ€/æ‰˜ç¦ Â· å¤šè‰²æ¨ªå‘å¯¼èˆª + åŒè¯­æ€ç»´å¯¼å›¾</title>
    <style>
        /* ----- å…¨å±€å˜é‡ & åŸºç¡€æ ·å¼ ----- */
        :root {
            --primary-color: #2563eb;
            --primary-light: #dbeafe;
            --bg-color: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-sub: #334155;
            --text-light: #64748b;
            --border-light: #e2e8f0;
            --highlight: #fef9c3;
            --success-border: #22c55e;   /* ç”¨æˆ·ç¬”è®°å·¦ä¾§è¾¹æ¡†è‰² */
            --danger: #ef4444;
            --shadow-sm: 0 2px 6px rgba(0, 0, 0, 0.03), 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-hover: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        /* å¤šè‰²èƒŒæ™¯ç±» (ç”¨äºæ ¸å¿ƒè®ºç‚¹å¡ç‰‡) */
        .branch-color-0 { background-color: #f0f7ff; } /* æµ…è“ */
        .branch-color-1 { background-color: #f0fdf4; } /* æµ…ç»¿ */
        .branch-color-2 { background-color: #fff7ed; } /* æµ…æ©™ */
        .branch-color-3 { background-color: #fef9c3; } /* æµ…é»„ */
        .branch-color-4 { background-color: #f3e8ff; } /* æµ…ç´« */
        .branch-color-5 { background-color: #ffe4e6; } /* æµ…ç²‰ */

        /* ç”¨æˆ·æ·»åŠ çš„å¡ç‰‡ï¼šä¿ç•™ç»¿è‰²å·¦è¾¹æ¡†ï¼ŒèƒŒæ™¯ç”±é¢œè‰²ç±»å†³å®š */
        .branch-card.user-added {
            border-left: 8px solid var(--success-border) !important;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.5;
            margin: 0;
            padding: 20px;
        }

        .container { max-width: 1300px; margin: 0 auto; }

        header {
            text-align: center;
            margin-bottom: 24px;
            background: var(--card-bg);
            padding: 20px 20px 16px;
            border-radius: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
        }
        h1 { margin: 0 0 6px 0; color: var(--primary-color); font-size: 1.9rem; font-weight: 600; }
        p.subtitle { color: var(--text-light); margin: 0 0 16px 0; font-size: 0.95rem; }

        .controls {
            display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;
        }

        input[type="text"] {
            padding: 10px 18px; width: 300px; border: 2px solid var(--border-light);
            border-radius: 40px; font-size: 14px; outline: none; transition: all 0.2s;
            background-color: white;
        }
        input[type="text"]:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px var(--primary-light); }

        button {
            padding: 8px 20px; border: none; border-radius: 40px; cursor: pointer;
            font-weight: 500; transition: all 0.15s; color: white; font-size: 13px;
            box-shadow: var(--shadow-sm);
        }
        button:hover { transform: translateY(-1px); box-shadow: var(--shadow-hover); }
        .btn-word { background-color: #1e3a5f; }
        .btn-pdf { background-color: #b91c1c; }
        .btn-backup { background-color: #0d9488; }
        .btn-reset { background-color: #475569; }

        /* ----- æ¨ªå‘è¯é¢˜å¯¼èˆªæ  ----- */
        .topic-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 28px;
            background: white;
            padding: 16px 20px;
            border-radius: 60px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
        }
        .topic-tab {
            background: #f1f5f9;
            border: none;
            border-radius: 40px;
            padding: 10px 20px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #334155;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
            box-shadow: none;
            color: var(--text-main);
        }
        .topic-tab:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
        }
        .topic-tab.active {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(37,99,235,0.3);
        }

        /* è¯é¢˜å¡ç‰‡ (ç°åœ¨åªæ˜¾ç¤ºä¸€ä¸ª) */
        .topic-card {
            background: var(--card-bg);
            border-radius: 28px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            overflow: visible;
            border: 1px solid var(--border-light);
        }

        .topic-header {
            background: #f8fafc;
            padding: 18px 24px;
            font-weight: 600;
            font-size: 1.3rem;
            color: var(--primary-color);
            border-bottom: 1px solid var(--border-light);
            border-radius: 28px 28px 0 0;
        }

        .topic-content { padding: 24px; background: #ffffff; }

        /* ----- æ¨ªå‘åˆ†æ”¯å®¹å™¨ (æ ¸å¿ƒè®ºç‚¹å¹¶æ’) ----- */
        .topic-branches {
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
            margin-bottom: 20px;
        }

        .branch-card {
            flex: 1 1 300px;
            min-width: 280px;
            border: 1px solid #edf2f7;
            border-radius: 24px;
            padding: 18px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
            transition: all 0.1s ease;
            align-self: flex-start;
        }
        .branch-card:hover { border-color: #cbd5e1; filter: brightness(0.98); }

        .node-row {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
        }
        .node-text {
            flex: 1;
            font-size: 1rem;
        }
        .node-text strong {
            font-weight: 600;
            color: var(--text-main);
            font-size: 1.1rem;
        }
        .en-text {
            display: block;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 5px;
            font-style: normal;
            font-weight: 400;
            line-height: 1.4;
            border-left: 2px solid var(--primary-light);
            padding-left: 10px;
        }

        /* çºµå‘å­èŠ‚ç‚¹æ ‘ (ä¿æŒä¸­æ€§æµ…ç°) */
        ul.tree {
            list-style-type: none;
            padding-left: 0;
            margin: 16px 0 8px 0;
        }
        ul.tree li {
            position: relative;
            margin-bottom: 10px;
            padding: 14px 16px;
            background-color: #f9fbfe;
            border: 1px solid #e9edf2;
            border-radius: 18px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
            list-style: none;
        }
        ul.tree li::before { content: none; }
        ul.tree ul.tree {
            margin-left: 20px;
            margin-top: 12px;
        }
        ul.tree ul.tree li {
            background-color: #f6f9fc;
            border-color: #dde3ea;
        }

        .delete-btn {
            color: var(--danger);
            background: rgba(255,255,255,0.8);
            border: 1px solid #fee2e2;
            cursor: pointer;
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 40px;
            opacity: 0;
            transition: opacity 0.15s, background 0.15s;
            font-weight: 500;
            line-height: 1;
            backdrop-filter: blur(2px);
            flex-shrink: 0;
        }
        .branch-card:hover .delete-btn,
        li:hover .delete-btn { opacity: 0.9; }
        .delete-btn:hover { background: #fee2e2; }

        /* æ·»åŠ åŒºåŸŸ */
        .add-section {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 2px dashed var(--border-light);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        .add-btn {
            background-color: var(--primary-color);
            font-size: 14px;
            padding: 10px 20px;
            border-radius: 40px;
        }
        .input-mini {
            padding: 10px 14px;
            border: 2px solid var(--border-light);
            border-radius: 30px;
            font-size: 14px;
            background: white;
            transition: 0.15s;
        }
        .input-mini:focus { border-color: var(--primary-color); outline: none; }
        .input-cn { width: 160px; }
        .input-en { width: 160px; }
        .input-detail { width: 240px; }
        .save-mini {
            background-color: #059669;
            padding: 10px 20px;
            border-radius: 40px;
        }

        mark {
            background-color: var(--highlight);
            color: #854d0e;
            padding: 2px 6px;
            border-radius: 12px;
            font-weight: 500;
            border: 1px solid #fde047;
        }

        .no-result {
            text-align: center;
            color: var(--text-light);
            padding: 40px;
            font-size: 1.2rem;
            background: white;
            border-radius: 40px;
            display: none;
        }

        @media print {
            .topic-nav, .controls, .add-section, .delete-btn { display: none !important; }
            .topic-card { break-inside: avoid; border: 1px solid #000; }
            .topic-content { display: block !important; }
            .branch-card { border: 1px solid #000; page-break-inside: avoid; background: white !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ¨ å¤šè‰²æ¨ªå‘å¯¼èˆª Â· åŒè¯­æ€ç»´å¯¼å›¾</h1>
        <p class="subtitle">æ ¸å¿ƒè®ºç‚¹å¡ç‰‡æŒ‰ç´¢å¼•å¾ªç¯æŸ”å’Œè‰²ç³» Â· ç”¨æˆ·ç¬”è®°å·¦ä¾§ç»¿è¾¹ Â· å­èŠ‚ç‚¹ä¸­æ€§ç°</p>
        <div class="controls">
            <input type="text" id="searchInput" placeholder="æœç´¢ä¸­æ–‡/è‹±æ–‡...">
            <button class="btn-reset" onclick="resetSearch()">é‡ç½®</button>
            <button class="btn-backup" onclick="exportFullHTML()">ğŸ“¥ å¤‡ä»½å…¨éƒ¨</button>
            <button class="btn-word" onclick="exportWord()">ğŸ“„ å¯¼å‡ºWord</button>
            <button class="btn-pdf" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°</button>
        </div>
    </header>

    <!-- æ¨ªå‘è¯é¢˜å¯¼èˆªæ  (åŠ¨æ€ç”Ÿæˆ) -->
    <div class="topic-nav" id="topicNav"></div>

    <!-- å½“å‰è¯é¢˜å†…å®¹å°†æ¸²æŸ“åœ¨æ­¤ -->
    <div id="contentArea"></div>
    <div id="noResult" class="no-result">æœªæ‰¾åˆ°åŒ¹é…çš„å†…å®¹</div>
</div>

<script>
    // ------------------------------------------------------------
    // 1. åŸå§‹é™æ€æ•°æ® (ä¸ä¸Šä¸€ç‰ˆç›¸åŒï¼Œå·²æ‹†åˆ†ç»†èŠ‚ä¸ºå­èŠ‚ç‚¹)
    // ------------------------------------------------------------
    const rawStaticData = [
        {
            id: "t1", title: "1. æ•™è‚² + ä¸ªäººæå‡ (Education & Personal Improvement)",
            content: [
                { t: "æ•™è‚²çš„ä¸‰å¤§æ”¯æŸ±", e: "Three Pillars of Education", children: [
                    { t: "è·å–çŸ¥è¯†", e: "Acquiring Knowledge", children: [
                        { t: "æ‰©å±•è§†é‡", e: "Broadening Horizons", detail: "å­¦ä¹ å¤šæ ·åŒ–å­¦ç§‘; å¢å¼ºé€šè¯†ä¸ä¸–ç•Œç†è§£" },
                        { t: "èŒä¸šå‘å±•", e: "Career Development", detail: "è·å¾—ä¸“ä¸šæŠ€èƒ½ä¸å­¦å†; åæ ¡èƒŒæ™¯ä¼˜åŠ¿; é«˜è–ªå·¥ä½œä¸ç”Ÿæ´»æ°´å¹³æå‡" },
                        { t: "æ€ç»´è®­ç»ƒ", e: "Mental Training", detail: "åŸ¹å…»æƒ³è±¡åŠ›ä¸åˆ›é€ åŠ›; é€»è¾‘æ€ç»´; å¤šè§’åº¦åˆ†æé—®é¢˜" }
                    ]},
                    { t: "åŸ¹å…»é“å¾·å“è´¨", e: "Moral Development", children: [
                        { t: "æ˜è¾¨æ˜¯é", e: "Distinguishing Right from Wrong", detail: "å­¦ä¹ è¡Œä¸ºå‡†åˆ™; åŸ¹å…»è´£ä»»æ„Ÿ" },
                        { t: "è¡Œä¸ºè§„èŒƒ", e: "Behavioral Standards", detail: "æ ¡è§„çº¦æŸä¸è‰¯è¡Œä¸º; å¯“è¨€æ•…äº‹æ•™å¯¼ç¾å¾·" },
                        { t: "ç¤¼ä»ªæ•™å…»", e: "Etiquette & Manners", detail: "è¯¾å ‚ä¼ æˆè‰¯å¥½ä¸¾æ­¢; ä¸æ‰“æ–­ä»–äººã€ç¤¼è²Œè¡¨è¾¾" }
                    ]},
                    { t: "æå‡å…³é”®æŠ€èƒ½", e: "Skill Enhancement", children: [
                        { t: "ç¤¾äº¤ä¸æ²Ÿé€š", e: "Social & Communication Skills", detail: "äººé™…äº¤å¾€æŠ€å·§; æœ‰æ•ˆåˆä½œ; æ¢ä½æ€è€ƒ; èŒåœºäººè„‰å»ºç«‹" },
                        { t: "è§£å†³é—®é¢˜èƒ½åŠ›", e: "Problem-Solving Skills", detail: "ç­›é€‰æœ‰ç”¨ä¿¡æ¯; å¿«é€Ÿç†è§£ä¸åˆ©ç”¨; é«˜æ•ˆè§£å†³" },
                        { t: "ç”Ÿæ´»è‡ªç†èƒ½åŠ›", e: "Life Skills", detail: "åŸºæœ¬æ¸…æ´ä¸ç»´ä¿®; å®ç°ç‹¬ç«‹" },
                        { t: "æ—¶é—´ç®¡ç†", e: "Time Management", detail: "æé«˜æ•ˆç‡; å¹³è¡¡å·¥ä½œä¸ç”Ÿæ´»" }
                    ]}
                ]},
                { t: "ä¸ªäººæå‡ä¸å¥åº·", e: "Personal Improvement & Health", children: [
                    { t: "èº«ä½“å¥åº·", e: "Physical Health", detail: "è§„å¾‹è¿åŠ¨å¢å¼ºä½“è´¨; é¢„é˜²ç–¾ç—…; ç‡ƒçƒ§å¡è·¯é‡Œ; æé«˜èº«ä½“æœºèƒ½" },
                    { t: "å¿ƒç†å¥åº·", e: "Mental Health", detail: "é‡Šæ”¾å†…å•¡è‚½å’Œå¤šå·´èƒº; ç¼“è§£å‹åŠ›; åŸ¹å…»ç§¯æç”Ÿæ´»æ€åº¦" }
                ]}
            ]
        },
        {
            id: "t2", title: "2. ç§‘æŠ€ + åª’ä½“ (Technology & Media)",
            content: [
                { t: "ç§‘æŠ€çš„ç§¯æå½±å“", e: "Pros of Technology", children: [
                    { t: "äº¤æµä¸ç¤¾äº¤", e: "Communication & Socializing", detail: "æ™ºèƒ½æ‰‹æœºå…´èµ·; ç»´æŒè¿œè·ç¦»å…³ç³»; æä¾›å‘å£°å¹³å°" },
                    { t: "çŸ¥è¯†è·å–", e: "Access to Knowledge", detail: "è§¦æ‰‹å¯åŠ; å®æ—¶æ›´æ–°; ç»æµå®æƒ " },
                    { t: "å·¥ä½œæ•ˆç‡", e: "Work Efficiency", detail: "è¿œç¨‹åŠå…¬; èŠ‚çœé€šå‹¤æ—¶é—´; æé«˜ç”Ÿäº§åŠ›" },
                    { t: "ç½‘ä¸Šè´­ç‰©", e: "Online Shopping", detail: "é€‰æ‹©å¤šæ ·; ä»·æ ¼æ›´ä½; é…é€é«˜æ•ˆ" }
                ]},
                { t: "ç§‘æŠ€çš„æ¶ˆæå½±å“", e: "Cons of Technology", children: [
                    { t: "éšç§ä¾µçŠ¯", e: "Privacy Invasion", detail: "æ•°æ®æ»¥ç”¨; èº«ä»½ç›—çªƒ; éœ€å¹³è¡¡è¿›æ­¥ä¸éšç§" },
                    { t: "æš´åŠ›ä¿¡æ¯æ³›æ»¥", e: "Proliferation of Violent Information", detail: "å¯¹ç°å®æš´åŠ›è„±æ•; å¢åŠ æš´åŠ›è¡Œä¸ºå¯èƒ½æ€§" },
                    { t: "èº«å¿ƒå¥åº·é—®é¢˜", e: "Physical & Mental Health", detail: "ä¹…åæˆç˜¾; è§†åŠ›å—æŸ; ç¤¾äº¤å­¤ç«‹; æ²‰è¿·è™šæ‹Ÿä¸–ç•Œ" }
                ]},
                { t: "ç”µè§†ä¸ç”µå½±", e: "TV & Cinema", children: [
                    { t: "ç§¯æä½œç”¨", e: "Pros", detail: "å¢é•¿è§è¯†; æ”¾æ¾èº«å¿ƒ; å¢å¼ºæ–‡åŒ–è®¤åŒ; ä¿ƒè¿›å®¶åº­å…³ç³»" }
                ]},
                { t: "å¹¿å‘Š", e: "Advertising", children: [
                    { t: "ç§¯æä½œç”¨", e: "Pros", detail: "ä¿¡æ¯é€æ˜; åˆºæ¿€ç»æµ; å…¬ç›Šå¹¿å‘Šæå‡æ„è¯†" },
                    { t: "æ¶ˆæä½œç”¨", e: "Cons", detail: "è¯¯å¯¼ä»·å€¼è§‚; è™šå‡å®£ä¼ ; æ¨å¹¿ä¸å¥åº·ç”Ÿæ´»æ–¹å¼" }
                ]},
                { t: "æ–°é—»åª’ä½“å¼Šç«¯", e: "Cons of News Media", children: [
                    { t: "è¿½é€åˆ©æ¶¦", e: "Seeking Profit", detail: "åˆ¶é€ å‡æ–°é—»; ä¿¡æ¯ä¸å¯é " },
                    { t: "æ”¿æ²»å‹åŠ›", e: "Political Pressure", detail: "å—æ”¿åºœæ§åˆ¶; é™åˆ¶æ‰¹è¯„æ›å…‰" }
                ]}
            ]
        },
        {
            id: "t3", title: "3. æ–‡åŒ– + å†å² (Culture & History)",
            content: [
                { t: "å­¦ä¹ ä¸åŒæ–‡åŒ–çš„å¥½å¤„", e: "Benefits of Learning Different Cultures", detail: "å‡å°‘è¯¯è§£ä¸å†²çª; å¼€é˜”è§†é‡ä¸åˆ›æ–°æ€ç»´; åŸ¹å…»åŒç†å¿ƒ" },
                { t: "æŠ•èµ„è‰ºæœ¯é¡¹ç›®çš„æ„ä¹‰", e: "Investment in Art Projects", detail: "ä¿æŠ¤æ–‡åŒ–å¤šæ ·æ€§; å¢å¼ºæ°‘æ—å½’å±æ„Ÿ; ä¿ƒè¿›ç»æµä¸æ—…æ¸¸; ä¸°å¯Œæ–‡åŒ–ç”Ÿæ´»" },
                { t: "åšç‰©é¦†çš„ç‹¬ç‰¹ä»·å€¼", e: "Unique Value of Museums", detail: "åœ°æ ‡ä¸ç»æµè´¡çŒ®; æ–‡åŒ–ä¼ æ‰¿; ç¬¬ä¸€æ‰‹å¤šæ„Ÿå®˜ä½“éªŒ; ä¿¡æ¯çœŸå®æ€§" },
                { t: "å­¦ä¹ å†å²çš„ä½œç”¨", e: "Role of Learning History", detail: "ä»¥å²ä¸ºé‰´ (é¿å…é‡è¹ˆè¦†è¾™); å¢å¼ºæ°‘æ—è®¤åŒ" },
                { t: "å›½é™…æ—…æ¸¸ä½“éªŒæ–‡åŒ–", e: "International Tourism", detail: "çº æ­£åˆ»æ¿å°è±¡; çœŸå®äº†è§£ä»–å›½; å‡å°‘å†²çª" }
            ]
        },
        {
            id: "t4", title: "4. å·¥ä½œ + åŸå¸‚ (Work & Cities)",
            content: [
                { t: "åŸå¸‚ä¸å†œæ‘çš„åŒºåˆ«", e: "Cities vs. Countryside", detail: "åŸºç¡€è®¾æ–½å·®å¼‚; å°±ä¸šä¸ç”Ÿæ´»æ°´å¹³; ç”Ÿæ´»èŠ‚å¥; äººé™…å…³ç³»ä¸æ€§æ ¼" },
                { t: "åŸå¸‚åŒ–çš„é—®é¢˜", e: "Problems of Urbanization", detail: "ç¯å¢ƒæ¶åŒ–; ä½æˆ¿å±æœº; äº¤é€šæ‹¥å µ; çŠ¯ç½ªç‡ä¸Šå‡; ç¤¾åŒºå‡èšåŠ›ä¸‹é™" },
                { t: "è§£å†³æ–¹æ³•", e: "Solutions", detail: "å‘å±•ä¹¡æ‘ç»æµ; åŸå¸‚æ‰©å¼ ä¸åŸºå»ºæŠ•å…¥" },
                { t: "ç°ä»£å·¥ä½œå‹åŠ›", e: "Modern Work Stress", detail: "å¿«èŠ‚å¥ä¸ç«äº‰æ¿€çƒˆ; éš¾ä»¥å¹³è¡¡ç”Ÿæ´»; å¿½è§†å°ç¡®å¹¸; ç§‘æŠ€å¯¼è‡´çš„ä¿¡æ¯è½°ç‚¸" }
            ]
        },
        {
            id: "t5", title: "5. æ”¿åºœ (Government)",
            content: [
                { t: "è´¢æ”¿æ”¶å…¥åˆ†é…ä¼˜å…ˆçº§", e: "Priority of Budget Allocation", children: [
                    { t: "ä¼˜å…ˆå…¬å…±æœåŠ¡", e: "Prioritize public services", detail: "æ•™è‚²ã€åŒ»ç–—ã€äº¤é€šã€ä½æˆ¿" },
                    { t: "å…·ä½“æŠ•èµ„å›æŠ¥", e: "Specific Returns", detail: "æ•™è‚²æé«˜å°±ä¸š; åŒ»ç–—ä¿ƒè¿›ç¨³å®š; äº¤é€šæé«˜æ•ˆç‡" }
                ]},
                { t: "æ”¿åºœèŒèƒ½ä¸æ‰‹æ®µ", e: "Government Functions & Tools", children: [
                    { t: "ç¨æ”¶", e: "Taxation", detail: "è´¢å¯Œå†åˆ†é…; è§„èŒƒè¡Œä¸º (çƒŸé…’é‡ç¨)" },
                    { t: "å¥–åŠ±ä¸è¡¥è´´", e: "Incentives & Subsidies", detail: "æä¾›ç»æµæ¿€åŠ±; æŠ•èµ„ç‰¹å®šè¡Œä¸š" },
                    { t: "ç«‹æ³•", e: "Legislation", detail: "è§„èŒƒå…¬æ°‘è¡Œä¸º; éœ‡æ…‘ä¸è‰¯è¡Œä¸º; ç»´æŠ¤ç¤¾ä¼šç¨³å®š" },
                    { t: "å®£ä¼ ", e: "Awareness Campaigns", detail: "æé«˜ç¯ä¿æ„è¯†; å‡è½»æ±¡æŸ“" }
                ]}
            ]
        },
        {
            id: "t6", title: "6. è€é¾„åŒ– (Ageing Population)",
            content: [
                { t: "äººå£è€é¾„åŒ–çš„åå¤„", e: "Disadvantages", children: [
                    { t: "åŠ³åŠ¨åŠ›çŸ­ç¼º", e: "Shortage of young workers", detail: "å¨èƒç»æµå‘å±•; ç¼ºä¹åˆ›æ–°æ´»åŠ›" },
                    { t: "ç¤¾ä¼šç¦åˆ©å‹åŠ›", e: "Strain on social welfare", detail: "åŒ»ç–—ç³»ç»Ÿå‹åŠ›; å…»è€é‡‘è´Ÿæ‹…" },
                    { t: "ç”Ÿäº§åŠ›é—®é¢˜", e: "Productivity issues", detail: "å·¥ä½œèŠ‚å¥æ…¢; æŠ€æœ¯é€‚åº”éš¾" }
                ]},
                { t: "äººå£è€é¾„åŒ–çš„å¥½å¤„", e: "Advantages", detail: "å¥åº·çŠ¶å†µæ”¹å–„; ç»éªŒä¸æ™ºæ…§ (æ‹…ä»»é¡¾é—®); æ€§æ ¼æˆç†Ÿç¨³é‡" },
                { t: "è§£å†³å¯¹ç­–", e: "Solutions", detail: "é¼“åŠ±å»¶è¿Ÿé€€ä¼‘; é¼“åŠ±å‚¨è“„ä¸å…»è€é‡‘è®¡åˆ’; é™ä½ç…§é¡¾æˆæœ¬" }
            ]
        },
        {
            id: "t7", title: "7. èŒä¸šå¥³æ€§ (Working Women)",
            content: [
                { t: "å¥³æ€§è¿›å…¥èŒåœºçš„å¥½å¤„", e: "Benefits of Hiring Women", children: [
                    { t: "ç‰¹å®šè¡Œä¸šè¡¨ç°æ›´ä½³", e: "Outperform in some industries", detail: "å…·å¤‡åŒæƒ…å¿ƒ; é€‚åˆæŠ¤ç†ä¸æ—©æ•™" },
                    { t: "ä¿ƒè¿›åˆ›æ–°ä¸æ”¶å…¥", e: "Promote innovation & Revenue", detail: "å¤šæ ·åŒ–åŠ³åŠ¨åŠ›; æä¾›ä¸åŒè§‚ç‚¹; æœåŠ¡æ›´å¹¿äººç¾¤" },
                    { t: "æ‰“ç ´æ€§åˆ«æˆè§", e: "Break sex stereotypes", detail: "å±•ç¤ºèƒ½åŠ›; ç¼©å°æ”¶å…¥å·®è·" }
                ]},
                { t: "å¥³æ€§åœ¨èŒåœºçš„æŒ‘æˆ˜", e: "Challenges", children: [
                    { t: "é›‡ä¸»åè§", e: "Employer bias", detail: "ç¼ºä¹å°Šé‡; æ™‹å‡å›°éš¾" },
                    { t: "å¯¹å·¥ä½œæŠ•å…¥çš„æ‹…å¿§", e: "Doubts about commitment", detail: "æ‹…å¿ƒäº§å‡; å®¶åº­äº‹åŠ¡ç‰µç»Š" }
                ]}
            ]
        },
        {
            id: "t8", title: "8. çŠ¯ç½ª (Crime)",
            content: [
                { t: "çŠ¯ç½ªçš„åŸå› ", e: "Causes of Crime", children: [
                    { t: "è´«å›°ä¸å¤±ä¸š", e: "Poverty & Unemployment", detail: "æ— æ”¶å…¥æ¥æº; ä¸ºè°‹ç”ŸçŠ¯ç½ª" },
                    { t: "è´«å¯Œå·®è·", e: "Widening gap", detail: "å¿ƒç”Ÿä¸æ»¡; å®£æ³„æ„¤æ€’" },
                    { t: "å®¶åº­ç–å¿½", e: "Negligent parents", detail: "æœªå­¦ä¹ è¡Œä¸ºè§„èŒƒ; ä¸è‰¯è¡Œä¸ºæ¼”å˜ä¸ºçŠ¯ç½ª" },
                    { t: "åª’ä½“æš´åŠ›å½±å“", e: "Exposure to violence", detail: "è§†æš´åŠ›ä¸ºè§£å†³æ–¹å¼; å¿½ç•¥åæœ" }
                ]},
                { t: "é¢„é˜²ä¸å‡å°‘çŠ¯ç½ªçš„æ–¹æ³•", e: "Methods to Reduce Crime", children: [
                    { t: "åˆ‘ç½š", e: "Prison sentence", detail: "éœ‡æ…‘ä½œç”¨; å¤±å»è‡ªç”±ææƒ§" },
                    { t: "æ•™è‚²", e: "Education", detail: "æå‡æŠ€èƒ½; æ•™æˆè¡Œä¸ºè§„èŒƒ; å¢åŠ å°±ä¸šæœºä¼š" },
                    { t: "ç¤¾åŒºæœåŠ¡", e: "Community service", detail: "åŸ¹å…»è´£ä»»æ„Ÿ; é˜²æ­¢å†çŠ¯" }
                ]},
                { t: "æ”¹é€ ä¸æƒ©ç½šçš„å¯¹æ¯”", e: "Reform vs. Punishment", detail: "ç›‘ç¦ (éš”ç¦»ç¤¾ä¼š); æ•™è‚²åŸ¹è®­ (èå…¥ç¤¾ä¼š); ç¤¾åŒºæœåŠ¡ (åšè´¡çŒ®)" }
            ]
        }
    ];

    // æ‹†åˆ†detailä¸ºå­èŠ‚ç‚¹çš„å‡½æ•° (ä¸ä¸Šä¸€ç‰ˆç›¸åŒ)
    function splitDetailIntoNodes(node) {
        if (!node.detail || node.children) return node;
        const phrases = node.detail.split(/[;ï¼›]\s*/).filter(p => p.trim() !== '');
        if (phrases.length === 0) return node;

        const map = {
            'æ™ºèƒ½æ‰‹æœºå…´èµ·': 'Rise of smartphones',
            'ç»´æŒè¿œè·ç¦»å…³ç³»': 'Maintain long-distance relationships',
            'æä¾›å‘å£°å¹³å°': 'Provide a platform for voices',
            'è§¦æ‰‹å¯åŠ': 'Information at your fingertips',
            'å®æ—¶æ›´æ–°': 'Real-time updates',
            'ç»æµå®æƒ ': 'Cost-effective',
            'è¿œç¨‹åŠå…¬': 'Remote work',
            'èŠ‚çœé€šå‹¤æ—¶é—´': 'Save commuting time',
            'æé«˜ç”Ÿäº§åŠ›': 'Increase productivity',
            'é€‰æ‹©å¤šæ ·': 'Wide selection',
            'ä»·æ ¼æ›´ä½': 'Lower prices',
            'é…é€é«˜æ•ˆ': 'Efficient delivery',
            'æ•°æ®æ»¥ç”¨': 'Data misuse',
            'èº«ä»½ç›—çªƒ': 'Identity theft',
            'éœ€å¹³è¡¡è¿›æ­¥ä¸éšç§': 'Need to balance progress and privacy',
            'å¯¹ç°å®æš´åŠ›è„±æ•': 'Desensitization to real violence',
            'å¢åŠ æš´åŠ›è¡Œä¸ºå¯èƒ½æ€§': 'Increase likelihood of violent behavior',
            'ä¹…åæˆç˜¾': 'Sedentary addiction',
            'è§†åŠ›å—æŸ': 'Vision damage',
            'ç¤¾äº¤å­¤ç«‹': 'Social isolation',
            'æ²‰è¿·è™šæ‹Ÿä¸–ç•Œ': 'Indulgence in virtual world',
            'å¢é•¿è§è¯†': 'Broaden knowledge',
            'æ”¾æ¾èº«å¿ƒ': 'Relax body and mind',
            'å¢å¼ºæ–‡åŒ–è®¤åŒ': 'Enhance cultural identity',
            'ä¿ƒè¿›å®¶åº­å…³ç³»': 'Promote family bonds',
            'ä¿¡æ¯é€æ˜': 'Information transparency',
            'åˆºæ¿€ç»æµ': 'Stimulate economy',
            'å…¬ç›Šå¹¿å‘Šæå‡æ„è¯†': 'Public service ads raise awareness',
            'è¯¯å¯¼ä»·å€¼è§‚': 'Misleading values',
            'è™šå‡å®£ä¼ ': 'False advertising',
            'æ¨å¹¿ä¸å¥åº·ç”Ÿæ´»æ–¹å¼': 'Promote unhealthy lifestyles',
            'åˆ¶é€ å‡æ–°é—»': 'Fake news production',
            'ä¿¡æ¯ä¸å¯é ': 'Unreliable information',
            'å—æ”¿åºœæ§åˆ¶': 'Government control',
            'é™åˆ¶æ‰¹è¯„æ›å…‰': 'Limit exposure of criticism',
            'å­¦ä¹ å¤šæ ·åŒ–å­¦ç§‘': 'Study diverse subjects',
            'å¢å¼ºé€šè¯†ä¸ä¸–ç•Œç†è§£': 'Enhance general knowledge and global understanding',
            'è·å¾—ä¸“ä¸šæŠ€èƒ½ä¸å­¦å†': 'Acquire professional skills and qualifications',
            'åæ ¡èƒŒæ™¯ä¼˜åŠ¿': 'Advantages of prestigious school background',
            'é«˜è–ªå·¥ä½œä¸ç”Ÿæ´»æ°´å¹³æå‡': 'Higher salary and improved living standards',
            'åŸ¹å…»æƒ³è±¡åŠ›ä¸åˆ›é€ åŠ›': 'Cultivate imagination and creativity',
            'é€»è¾‘æ€ç»´': 'Logical thinking',
            'å¤šè§’åº¦åˆ†æé—®é¢˜': 'Analyze problems from multiple perspectives',
            'å­¦ä¹ è¡Œä¸ºå‡†åˆ™': 'Learn codes of conduct',
            'åŸ¹å…»è´£ä»»æ„Ÿ': 'Cultivate responsibility',
            'æ ¡è§„çº¦æŸä¸è‰¯è¡Œä¸º': 'School rules restrain misconduct',
            'å¯“è¨€æ•…äº‹æ•™å¯¼ç¾å¾·': 'Fables teach virtues',
            'è¯¾å ‚ä¼ æˆè‰¯å¥½ä¸¾æ­¢': 'Classroom teaches good manners',
            'ä¸æ‰“æ–­ä»–äººã€ç¤¼è²Œè¡¨è¾¾': 'Do not interrupt others, polite expression',
            'äººé™…äº¤å¾€æŠ€å·§': 'Interpersonal skills',
            'æœ‰æ•ˆåˆä½œ': 'Effective cooperation',
            'æ¢ä½æ€è€ƒ': 'Empathy',
            'èŒåœºäººè„‰å»ºç«‹': 'Build professional networks',
            'ç­›é€‰æœ‰ç”¨ä¿¡æ¯': 'Filter useful information',
            'å¿«é€Ÿç†è§£ä¸åˆ©ç”¨': 'Quick comprehension and application',
            'é«˜æ•ˆè§£å†³': 'Efficient resolution',
            'åŸºæœ¬æ¸…æ´ä¸ç»´ä¿®': 'Basic cleaning and maintenance',
            'å®ç°ç‹¬ç«‹': 'Achieve independence',
            'æé«˜æ•ˆç‡': 'Improve efficiency',
            'å¹³è¡¡å·¥ä½œä¸ç”Ÿæ´»': 'Balance work and life',
            'è§„å¾‹è¿åŠ¨å¢å¼ºä½“è´¨': 'Regular exercise strengthens body',
            'é¢„é˜²ç–¾ç—…': 'Prevent diseases',
            'ç‡ƒçƒ§å¡è·¯é‡Œ': 'Burn calories',
            'æé«˜èº«ä½“æœºèƒ½': 'Improve physical function',
            'é‡Šæ”¾å†…å•¡è‚½å’Œå¤šå·´èƒº': 'Release endorphins and dopamine',
            'ç¼“è§£å‹åŠ›': 'Relieve stress',
            'åŸ¹å…»ç§¯æç”Ÿæ´»æ€åº¦': 'Cultivate positive attitude towards life',
            'å‡å°‘è¯¯è§£ä¸å†²çª': 'Reduce misunderstandings and conflicts',
            'å¼€é˜”è§†é‡ä¸åˆ›æ–°æ€ç»´': 'Broaden horizons and innovative thinking',
            'åŸ¹å…»åŒç†å¿ƒ': 'Cultivate empathy',
            'ä¿æŠ¤æ–‡åŒ–å¤šæ ·æ€§': 'Protect cultural diversity',
            'å¢å¼ºæ°‘æ—å½’å±æ„Ÿ': 'Strengthen national identity',
            'ä¿ƒè¿›ç»æµä¸æ—…æ¸¸': 'Boost economy and tourism',
            'ä¸°å¯Œæ–‡åŒ–ç”Ÿæ´»': 'Enrich cultural life',
            'åœ°æ ‡ä¸ç»æµè´¡çŒ®': 'Landmarks and economic contribution',
            'æ–‡åŒ–ä¼ æ‰¿': 'Cultural heritage',
            'ç¬¬ä¸€æ‰‹å¤šæ„Ÿå®˜ä½“éªŒ': 'First-hand multi-sensory experience',
            'ä¿¡æ¯çœŸå®æ€§': 'Authenticity of information',
            'ä»¥å²ä¸ºé‰´ (é¿å…é‡è¹ˆè¦†è¾™)': 'Learn from history (avoid repeating mistakes)',
            'å¢å¼ºæ°‘æ—è®¤åŒ': 'Enhance national identity',
            'çº æ­£åˆ»æ¿å°è±¡': 'Correct stereotypes',
            'çœŸå®äº†è§£ä»–å›½': 'Truly understand other countries',
            'å‡å°‘å†²çª': 'Reduce conflicts',
            'åŸºç¡€è®¾æ–½å·®å¼‚': 'Infrastructure differences',
            'å°±ä¸šä¸ç”Ÿæ´»æ°´å¹³': 'Employment and living standards',
            'ç”Ÿæ´»èŠ‚å¥': 'Pace of life',
            'äººé™…å…³ç³»ä¸æ€§æ ¼': 'Interpersonal relationships and personality',
            'ç¯å¢ƒæ¶åŒ–': 'Environmental degradation',
            'ä½æˆ¿å±æœº': 'Housing crisis',
            'äº¤é€šæ‹¥å µ': 'Traffic congestion',
            'çŠ¯ç½ªç‡ä¸Šå‡': 'Rising crime rate',
            'ç¤¾åŒºå‡èšåŠ›ä¸‹é™': 'Decline in community cohesion',
            'å‘å±•ä¹¡æ‘ç»æµ': 'Develop rural economy',
            'åŸå¸‚æ‰©å¼ ä¸åŸºå»ºæŠ•å…¥': 'Urban expansion and infrastructure investment',
            'å¿«èŠ‚å¥ä¸ç«äº‰æ¿€çƒˆ': 'Fast pace and intense competition',
            'éš¾ä»¥å¹³è¡¡ç”Ÿæ´»': 'Difficulty balancing life',
            'å¿½è§†å°ç¡®å¹¸': 'Neglect small pleasures',
            'ç§‘æŠ€å¯¼è‡´çš„ä¿¡æ¯è½°ç‚¸': 'Information overload caused by technology',
            'æ•™è‚²ã€åŒ»ç–—ã€äº¤é€šã€ä½æˆ¿': 'Education, healthcare, transportation, housing',
            'æ•™è‚²æé«˜å°±ä¸š': 'Education improves employment',
            'åŒ»ç–—ä¿ƒè¿›ç¨³å®š': 'Healthcare promotes stability',
            'äº¤é€šæé«˜æ•ˆç‡': 'Transportation improves efficiency',
            'è´¢å¯Œå†åˆ†é…': 'Wealth redistribution',
            'è§„èŒƒè¡Œä¸º (çƒŸé…’é‡ç¨)': 'Regulate behavior (heavy taxes on tobacco and alcohol)',
            'æä¾›ç»æµæ¿€åŠ±': 'Provide economic incentives',
            'æŠ•èµ„ç‰¹å®šè¡Œä¸š': 'Invest in specific industries',
            'è§„èŒƒå…¬æ°‘è¡Œä¸º': 'Regulate citizen behavior',
            'éœ‡æ…‘ä¸è‰¯è¡Œä¸º': 'Deter bad behavior',
            'ç»´æŠ¤ç¤¾ä¼šç¨³å®š': 'Maintain social stability',
            'æé«˜ç¯ä¿æ„è¯†': 'Raise environmental awareness',
            'å‡è½»æ±¡æŸ“': 'Reduce pollution',
            'å¨èƒç»æµå‘å±•': 'Threaten economic development',
            'ç¼ºä¹åˆ›æ–°æ´»åŠ›': 'Lack of innovation vitality',
            'åŒ»ç–—ç³»ç»Ÿå‹åŠ›': 'Pressure on healthcare system',
            'å…»è€é‡‘è´Ÿæ‹…': 'Pension burden',
            'å·¥ä½œèŠ‚å¥æ…¢': 'Slow work pace',
            'æŠ€æœ¯é€‚åº”éš¾': 'Difficulty adapting to technology',
            'å¥åº·çŠ¶å†µæ”¹å–„': 'Improved health conditions',
            'ç»éªŒä¸æ™ºæ…§ (æ‹…ä»»é¡¾é—®)': 'Experience and wisdom (serve as advisors)',
            'æ€§æ ¼æˆç†Ÿç¨³é‡': 'Mature and steady personality',
            'é¼“åŠ±å»¶è¿Ÿé€€ä¼‘': 'Encourage delayed retirement',
            'é¼“åŠ±å‚¨è“„ä¸å…»è€é‡‘è®¡åˆ’': 'Encourage savings and pension plans',
            'é™ä½ç…§é¡¾æˆæœ¬': 'Reduce care costs',
            'å…·å¤‡åŒæƒ…å¿ƒ': 'Possess compassion',
            'é€‚åˆæŠ¤ç†ä¸æ—©æ•™': 'Suitable for nursing and early education',
            'å¤šæ ·åŒ–åŠ³åŠ¨åŠ›': 'Diverse workforce',
            'æä¾›ä¸åŒè§‚ç‚¹': 'Provide different perspectives',
            'æœåŠ¡æ›´å¹¿äººç¾¤': 'Serve a wider population',
            'å±•ç¤ºèƒ½åŠ›': 'Demonstrate ability',
            'ç¼©å°æ”¶å…¥å·®è·': 'Narrow income gap',
            'ç¼ºä¹å°Šé‡': 'Lack of respect',
            'æ™‹å‡å›°éš¾': 'Difficulty in promotion',
            'æ‹…å¿ƒäº§å‡': 'Concerns about maternity leave',
            'å®¶åº­äº‹åŠ¡ç‰µç»Š': 'Family responsibilities',
            'æ— æ”¶å…¥æ¥æº': 'No source of income',
            'ä¸ºè°‹ç”ŸçŠ¯ç½ª': 'Commit crimes for survival',
            'å¿ƒç”Ÿä¸æ»¡': 'Feel discontent',
            'å®£æ³„æ„¤æ€’': 'Vent anger',
            'æœªå­¦ä¹ è¡Œä¸ºè§„èŒƒ': 'Not learned behavioral norms',
            'ä¸è‰¯è¡Œä¸ºæ¼”å˜ä¸ºçŠ¯ç½ª': 'Bad behavior evolves into crime',
            'è§†æš´åŠ›ä¸ºè§£å†³æ–¹å¼': 'See violence as a solution',
            'å¿½ç•¥åæœ': 'Ignore consequences',
            'éœ‡æ…‘ä½œç”¨': 'Deterrent effect',
            'å¤±å»è‡ªç”±ææƒ§': 'Fear of losing freedom',
            'æå‡æŠ€èƒ½': 'Improve skills',
            'æ•™æˆè¡Œä¸ºè§„èŒƒ': 'Teach behavioral norms',
            'å¢åŠ å°±ä¸šæœºä¼š': 'Increase employment opportunities',
            'é˜²æ­¢å†çŠ¯': 'Prevent reoffending',
            'ç›‘ç¦ (éš”ç¦»ç¤¾ä¼š)': 'Imprisonment (isolate from society)',
            'æ•™è‚²åŸ¹è®­ (èå…¥ç¤¾ä¼š)': 'Education and training (reintegrate into society)',
            'ç¤¾åŒºæœåŠ¡ (åšè´¡çŒ®)': 'Community service (make contributions)'
        };
        const children = phrases.map(phrase => ({
            t: phrase.trim(),
            e: map[phrase.trim()] || `[Translate: ${phrase.trim()}]`,
            _isAutoSplit: true
        }));
        const newNode = { ...node };
        delete newNode.detail;
        newNode.children = children;
        return newNode;
    }

    function expandDetailsInTree(nodes) {
        if (!nodes) return nodes;
        return nodes.map(node => {
            let processed = node;
            if (node.detail && !node.children) {
                processed = splitDetailIntoNodes(node);
            }
            if (processed.children) {
                processed.children = expandDetailsInTree(processed.children);
            }
            return processed;
        });
    }

    const staticData = rawStaticData.map(topic => ({
        ...topic,
        content: expandDetailsInTree(topic.content)
    }));

    // ------------------------------------------------------------
    // 2. çŠ¶æ€ç®¡ç† (å¢åŠ å½“å‰è¯é¢˜ç´¢å¼•)
    // ------------------------------------------------------------
    let allData = [];
    let currentTopicIndex = 0;
    const STORAGE_KEY = 'mindmap_user_notes_v1';

    function initData() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
            try {
                const parsed = JSON.parse(stored);
                allData = JSON.parse(JSON.stringify(staticData));
                parsed.forEach((topic, tIndex) => {
                    if (allData[tIndex] && topic.userNotes) {
                        topic.userNotes.forEach(note => {
                            allData[tIndex].content.push({
                                ...note,
                                _isUserAdded: true
                            });
                        });
                    }
                });
            } catch (e) {
                console.error("Error loading notes", e);
                allData = JSON.parse(JSON.stringify(staticData));
            }
        } else {
            allData = JSON.parse(JSON.stringify(staticData));
        }
    }

    function saveUserNotes() {
        const notesToSave = allData.map(topic => {
            const userNotes = topic.content.filter(item => item._isUserAdded);
            const cleanNotes = userNotes.map(({_isUserAdded, ...rest}) => rest);
            return { id: topic.id, userNotes: cleanNotes };
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(notesToSave));
    }

    function addNote(topicIndex, cn, en, detail) {
        if (!cn.trim()) return alert("è¯·è¾“å…¥ä¸­æ–‡å†…å®¹");
        const newNode = {
            t: cn,
            e: en,
            detail: detail,
            _isUserAdded: true
        };
        allData[topicIndex].content.push(newNode);
        saveUserNotes();
        renderCurrentTopic(searchInput.value.trim());
    }

    function deleteNote(topicIndex, nodeIndex) {
        if(!confirm("ç¡®å®šåˆ é™¤è¿™æ¡ç¬”è®°å—ï¼Ÿ")) return;
        allData[topicIndex].content.splice(nodeIndex, 1);
        saveUserNotes();
        renderCurrentTopic(searchInput.value.trim());
    }

    // ------------------------------------------------------------
    // 3. æ¸²æŸ“å‡½æ•°ï¼šåªæ¸²æŸ“æŒ‡å®šç´¢å¼•çš„è¯é¢˜
    // ------------------------------------------------------------
    const contentArea = document.getElementById('contentArea');
    const searchInput = document.getElementById('searchInput');
    const noResult = document.getElementById('noResult');
    const topicNav = document.getElementById('topicNav');

    function renderNav(activeIndex) {
        topicNav.innerHTML = '';
        allData.forEach((topic, idx) => {
            const btn = document.createElement('button');
            btn.className = `topic-tab ${idx === activeIndex ? 'active' : ''}`;
            let shortTitle = topic.title.replace(/^\d+\.\s*/, '').split('(')[0].trim();
            btn.textContent = shortTitle;
            btn.onclick = () => {
                currentTopicIndex = idx;
                searchInput.value = '';
                renderCurrentTopic('');
            };
            topicNav.appendChild(btn);
        });
    }

    function renderCurrentTopic(searchTerm = '') {
        if (!allData.length) return;
        const topic = allData[currentTopicIndex];
        const tIndex = currentTopicIndex;
        renderNav(currentTopicIndex);

        let hasMatch = false;

        function isMatch(node, term) {
            if (!term) return true;
            const text = `${node.t} ${node.e||''} ${node.detail||''}`.toLowerCase();
            return text.includes(term.toLowerCase());
        }
        function hasMatchingChild(nodes, term) {
            return nodes.some(child => {
                if (isMatch(child, term)) return true;
                if (child.children) return hasMatchingChild(child.children, term);
                return false;
            });
        }

        function buildBranch(node, nodeIdx) {
            const selfMatch = isMatch(node, searchTerm);
            const childHasMatch = node.children ? hasMatchingChild(node.children, searchTerm) : false;
            if (searchTerm && !selfMatch && !childHasMatch) return null;
            if (!searchTerm || selfMatch || childHasMatch) hasMatch = true;

            const branchDiv = document.createElement('div');
            branchDiv.className = 'branch-card';

            // æ ¹æ®ç´¢å¼•åˆ†é…é¢œè‰²ç±» (å¾ªç¯ä½¿ç”¨0-5)
            const colorIndex = nodeIdx % 6;
            branchDiv.classList.add(`branch-color-${colorIndex}`);

            if (node._isUserAdded) branchDiv.classList.add('user-added');

            let html = `<div class="node-row">
                <span class="node-text">
                    <strong>${highlight(node.t, searchTerm)}</strong>
                    ${node.e ? `<span class="en-text">${highlight(node.e, searchTerm)}</span>` : ''}
                </span>`;

            if (node._isUserAdded) {
                html += `<button class="delete-btn" onclick="deleteNote(${tIndex}, ${nodeIdx})">ğŸ—‘ï¸ åˆ é™¤</button>`;
            }
            html += `</div>`;

            if (node.detail) {
                html += `<span class="detail-text">${highlight(node.detail, searchTerm)}</span>`;
            }
            branchDiv.innerHTML = html;

            if (node.children && node.children.length > 0) {
                const childUl = document.createElement('ul');
                childUl.className = 'tree';
                buildTree(node.children, childUl, tIndex, searchTerm);
                branchDiv.appendChild(childUl);
            }
            return branchDiv;
        }

        function buildTree(nodes, parentUl, topicIndex, searchTerm) {
            nodes.forEach((node) => {
                const selfMatch = isMatch(node, searchTerm);
                const childHasMatch = node.children ? hasMatchingChild(node.children, searchTerm) : false;
                if (searchTerm && !selfMatch && !childHasMatch) return;

                const li = document.createElement('li');
                if (node._isUserAdded) li.classList.add('user-added');

                let html = `<div class="node-row">
                    <span class="node-text">
                        <strong>${highlight(node.t, searchTerm)}</strong>
                        ${node.e ? `<span class="en-text">${highlight(node.e, searchTerm)}</span>` : ''}
                    </span>`;
                html += `</div>`;

                if (node.detail) {
                    html += `<span class="detail-text">${highlight(node.detail, searchTerm)}</span>`;
                }
                li.innerHTML = html;

                if (node.children) {
                    const childUl = document.createElement('ul');
                    childUl.className = 'tree';
                    buildTree(node.children, childUl, topicIndex, searchTerm);
                    if (childUl.children.length > 0) li.appendChild(childUl);
                }
                parentUl.appendChild(li);
            });
        }

        const card = document.createElement('div');
        card.className = 'topic-card';

        const header = document.createElement('div');
        header.className = 'topic-header';
        header.textContent = topic.title;
        card.appendChild(header);

        const contentDiv = document.createElement('div');
        contentDiv.className = 'topic-content';

        const branchesContainer = document.createElement('div');
        branchesContainer.className = 'topic-branches';

        topic.content.forEach((node, idx) => {
            const branch = buildBranch(node, idx);
            if (branch) branchesContainer.appendChild(branch);
        });

        contentDiv.appendChild(branchesContainer);

        const addSection = document.createElement('div');
        addSection.className = 'add-section';
        addSection.innerHTML = `
            <button class="add-btn" onclick="toggleInput(${tIndex})">+ æ·»åŠ æ–°è®ºç‚¹</button>
            <div id="input-group-${tIndex}" style="display:none; width:100%; gap:10px; flex-wrap:wrap;">
                <input type="text" id="input-cn-${tIndex}" class="input-mini input-cn" placeholder="ä¸­æ–‡è®ºç‚¹">
                <input type="text" id="input-en-${tIndex}" class="input-mini input-en" placeholder="English Point">
                <input type="text" id="input-detail-${tIndex}" class="input-mini input-detail" placeholder="ç»†èŠ‚/ä¾‹å­ (å¯é€‰)">
                <button class="save-mini" onclick="addNote(${tIndex}, 
                    document.getElementById('input-cn-${tIndex}').value, 
                    document.getElementById('input-en-${tIndex}').value, 
                    document.getElementById('input-detail-${tIndex}').value)">ä¿å­˜</button>
            </div>
        `;
        contentDiv.appendChild(addSection);

        card.appendChild(contentDiv);
        contentArea.innerHTML = '';
        contentArea.appendChild(card);

        if (searchTerm && !hasMatch) {
            noResult.style.display = 'block';
        } else {
            noResult.style.display = 'none';
        }
    }

    function toggleInput(index) {
        const group = document.getElementById(`input-group-${index}`);
        if (group) {
            group.style.display = group.style.display === 'none' ? 'flex' : 'none';
            if(group.style.display === 'flex') document.getElementById(`input-cn-${index}`).focus();
        }
    }

    function highlight(text, term) {
        if (!term || !text) return text;
        const regex = new RegExp(`(${term})`, 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    }

    function performSearch(term) {
        if (!term.trim()) {
            renderCurrentTopic('');
            return;
        }
        let firstMatchIndex = -1;
        for (let i = 0; i < allData.length; i++) {
            const topic = allData[i];
            function nodeMatches(node) {
                if (isNodeMatch(node, term)) return true;
                if (node.children) {
                    for (let child of node.children) {
                        if (nodeMatches(child)) return true;
                    }
                }
                return false;
            }
            function isNodeMatch(node, t) {
                const text = `${node.t} ${node.e||''} ${node.detail||''}`.toLowerCase();
                return text.includes(t.toLowerCase());
            }
            const found = topic.content.some(root => nodeMatches(root));
            if (found) {
                firstMatchIndex = i;
                break;
            }
        }
        if (firstMatchIndex !== -1) {
            currentTopicIndex = firstMatchIndex;
            renderCurrentTopic(term);
        } else {
            renderCurrentTopic(term);
        }
    }

    function resetSearch() {
        searchInput.value = '';
        renderCurrentTopic('');
    }

    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.trim();
        performSearch(term);
    });

    // ------------------------------------------------------------
    // 4. å¯¼å‡ºåŠŸèƒ½ (ä¸ä¸Šä¸€ç‰ˆç›¸åŒ)
    // ------------------------------------------------------------
    function exportWord() {
        let fullHtml = '<html><head><meta charset="utf-8"><title>MindMap All Topics</title><style>';
        fullHtml += 'body{font-family:Arial; padding:20px;} .topic-card{border:1px solid #000; margin-bottom:30px; padding:15px; border-radius:8px;}';
        fullHtml += '.topic-branches{display:flex; flex-wrap:wrap; gap:16px;} .branch-card{border:1px solid #333; padding:12px; width:280px; margin:5px; background:#f9f9f9;}';
        fullHtml += 'ul{list-style-type:none; padding-left:16px;} li{border:1px solid #ccc; margin:6px 0; padding:8px; border-radius:5px;}';
        fullHtml += '.en-text{color:#555; font-style:italic;}</style></head><body>';

        allData.forEach(topic => {
            fullHtml += `<div class="topic-card"><h2>${topic.title}</h2>`;
            fullHtml += '<div class="topic-branches">';
            function buildNode(node) {
                let str = `<div class="branch-card"><strong>${node.t}</strong>`;
                if (node.e) str += `<div class="en-text">${node.e}</div>`;
                if (node.detail) str += `<div>${node.detail}</div>`;
                if (node.children) {
                    str += '<ul>';
                    node.children.forEach(child => {
                        str += `<li>${buildNode(child)}</li>`;
                    });
                    str += '</ul>';
                }
                str += '</div>';
                return str;
            }
            topic.content.forEach(root => {
                fullHtml += buildNode(root);
            });
            fullHtml += '</div></div>';
        });

        fullHtml += '</body></html>';
        const blob = new Blob([fullHtml], {type: 'application/msword'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'MindMap_All_Topics.doc';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function exportFullHTML() {
        let htmlContent = document.documentElement.outerHTML;
        const dataString = JSON.stringify(allData, null, 4);
        const regex = /const staticData = \[[\s\S]*?\];/;
        const replacement = `const staticData = ${dataString};`;
        let cleanHtml = htmlContent.replace(regex, replacement);
        const initFix = `
        function initData() {
            allData = JSON.parse(JSON.stringify(staticData)); 
        }`;
        const initRegex = /function initData\(\) \{[\s\S]*?\}/;
        cleanHtml = cleanHtml.replace(initRegex, initFix);
        const blob = new Blob([cleanHtml], {type: 'text/html'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `MindMap_Backup_${new Date().toISOString().slice(0,10)}.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    window.addNote = addNote;
    window.deleteNote = deleteNote;
    window.toggleInput = toggleInput;
    window.resetSearch = resetSearch;
    window.exportWord = exportWord;
    window.exportFullHTML = exportFullHTML;

    initData();
    renderNav(0);
    renderCurrentTopic('');
</script>

</body>
</html>